# 锦标赛生成逻辑修正说明

## 修正前的问题
原来的逻辑错误地计算第二轮及后续轮次的队伍数量和比赛安排，导致：
1. 轮空队伍没有得到正确处理
2. 第二轮比赛数量计算错误
3. 所有非第一轮比赛都被标记为"待定 vs 待定"

## 修正后的正确逻辑

### 42支队伍参赛示例：

#### 基础计算
- 实际队伍：42支
- 扩展到：64个位置（下一个2的幂次：2^6 = 64）
- 轮空队伍：64 - 42 = 22支
- 第一轮参赛：42 - 22 = 20支
- 第一轮比赛：20 ÷ 2 = 10场
- 总轮数：6轮

#### 各轮比赛安排

**第一轮（10场比赛）：**
- 20支队伍两两对战
- 产生10名胜者
- 状态：scheduled（双方都已确定）

**第二轮（16场比赛）：**
- 总队伍数：32支（10名第一轮胜者 + 22名轮空队伍）
- 比赛类型1：10场比赛，一方是第一轮胜者，一方是轮空队伍
  - 状态：pending（等待第一轮完成）
- 比赛类型2：6场比赛，双方都是轮空队伍
  - 状态：scheduled（双方都已确定）

**第三轮（8场比赛）：**
- 总队伍数：16支（第二轮16名胜者）
- 所有比赛：待定 vs 待定
- 状态：pending

**第四轮（4场比赛）：**
- 总队伍数：8支
- 所有比赛：待定 vs 待定
- 状态：pending

**第五轮（2场比赛）：**
- 总队伍数：4支（半决赛）
- 所有比赛：待定 vs 待定
- 状态：pending

**第六轮（1场比赛）：**
- 总队伍数：2支（决赛）
- 比赛：待定 vs 待定
- 状态：pending

## 代码修正要点

### 1. 第二轮队伍数计算修正
```typescript
// 修正前（错误）
let currentRoundTeamCount = firstRoundTeams / 2 + byeTeams.length

// 修正后（正确）
let currentRoundTeamCount = nextPowerOf2 / 2  // 第二轮应有的队伍数
```

### 2. 第二轮比赛安排修正
- **第一轮胜者 vs 轮空队伍**：轮空队伍已确定，第一轮胜者待定
- **轮空队伍 vs 轮空队伍**：双方都已确定，可直接比赛

### 3. 比赛状态设置
- `scheduled`：双方队伍都已确定
- `pending`：至少一方队伍待定（需要前序比赛结果）

## 验证效果
修正后的系统能够：
1. ✅ 正确计算各轮比赛数量
2. ✅ 合理安排轮空队伍
3. ✅ 准确设置比赛状态
4. ✅ 生成完整的锦标赛树结构
5. ✅ 支持任意数量队伍的锦标赛（2-1024支队伍）